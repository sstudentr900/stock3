<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
  </head>
  <body>
    <h2>JavaScript未定義的屬性</h2>
    <pre class="prettyprint">
      <xmp>
        const arr = [];
        console.log(arr[0].name); //會報錯
        console.log(arr[0] && arr[0].name);//不會報錯 
        console.log(arr[0]?.name);//等同上面
      </xmp>
    </pre>
    <h4>參考</h4>
    <ul>
      <li>
        <a href="https://bobbyhadz.com/blog/javascript-cannot-read-property-of-undefined">JavaScript 中未定義的屬性</a>
      </li>
    </ul>
    <hr>

    <h2>JavaScript 獲取數組的最後一個元素</h2>
    <pre class="prettyprint">
      <xmp>
        let arry = [2, 4, 6, 8, 10, 12, 14, 16];

        console.time('array length property');
        let lastElement = arry[arry.length - 1];
        console.log(lastElement); //16
        console.timeEnd('array length property');

        console.time('array slice method 回傳是array');
        let lastElement1 = arry.slice(-1);
        console.log(lastElement1); //[16]
        console.timeEnd('array slice method');

        console.time('array pop method 會改變數組的長度');
        let lastElement2 = arry.pop();
        console.log(lastElement2); //16
        console.timeEnd('array pop method');

        //Output:
        //array length property: 13.798ms
        //array slice method: 8.839ms
        //array pop method: 0.138ms
      </xmp>
    </pre>
    <h4>參考</h4>
    <ul>
      <li>
        <a href="https://flexiple.com/javascript/get-last-array-element-javascript/">最後一個元素</a>
      </li>
    </ul>
    <hr>

    <h2>JavaScript空白分割字串</h2>
    <pre class="prettyprint">
      <xmp>
        let s = "this        is  a book";
        let ss = s.split(/\s+/);  // "\\s+" 是正則表示式，代表至少一個或多個空白。
        console.log(ss);          // ["this", "is", "a", "book"]
        
        
        若只要用換行符號分割字串，則使用split(/\n/")。
        let s = "台北 文山\n新竹 竹南\n高雄 左營";
        let ss = s.split(/\n/);
        console.log(ss); // ["台北 文山", "新竹 竹南", "高雄 左營"]
      </xmp>
    </pre>
    <h4>參考</h4>
    <ul>
      <li>
        <a href="https://matthung0807.blogspot.com/2019/12/javascript-split-by-blank.html">空白分割字串</a>
      </li>
    </ul>
    <hr>

    <h2>JavaScript 字符串是否是数字</h2>
    <pre class="prettyprint">
      <xmp>
        function f(a){
          if(isNaN(Number(a,10))){
            console.log("不是数字");
          }
          else{
            console.log("是数字");
          }
        }
      </xmp>
    </pre>
    <h4>參考</h4>
    <ul>
      <li>
        <a href="https://www.cnblogs.com/heibaiqi/p/16628787.html"> javascript判断字符串是否是数字</a>
      </li>
    </ul>
    <hr>

    <h2>JavaScript 小數點四捨五入</h2>
    <pre class="prettyprint">
      <xmp>
        let number=Math.round(5.5)       
        // 6

        let number=Math.round( (Number('549.268')+Number.EPSILON) *100 ) /100;
        //549.27
      </xmp>
    </pre>

    <h2>JavaScript 陣列函數</h2>
    <pre class="prettyprint">
      <xmp></xmp>
    </pre>
    <h4>參考</h4>
    <ul>
      <li>
        <a href="https://www.casper.tw/javascript/2017/06/29/es6-native-array/">JavaScript 陣列</a>
      </li>
    </ul>
    <hr>

    <h2>JavaScript object values null</h2>
    <pre class="prettyprint">
      <xmp>
        var a = {}
        var b = {
          'a':'12'
        }
        console.log( Object.values(a).length) //0
        console.log( Object.values(b).length) //1
      </xmp>
    </pre>
    <hr>

    <h2>JavaScript 自組json</h2>
    <pre class="prettyprint">
      <xmp>
        json = []
        const name = 'king';
        const age = '20';
        json.push(Object.assign({ name, age }))
        console.log(json)
      </xmp>
    </pre>
    <h4>參考</h4>
    <ul>
      <li>
        <a href="https://www.cnblogs.com/heibaiqi/p/16628787.html"> javascript判断字符串是否是数字</a>
      </li>
    </ul>
    <hr>

    <h2>JavaScript Remove object values </h2>
    <pre class="prettyprint">
      <xmp>
        var person = {
          name: "Harry",
          age: 16,
          gender: "Male"
        };
        delete person.age;
        console.log(person.age);  // Prints: undefined
        console.log(person);  // Prints: {name: "Harry", gender: "Male"}
      </xmp>
    </pre>
    <hr>


    <h2>echarts 圖表</h2>
    <h3>ECharts关于y轴刻度调整</h3>
    <p></p>
    <pre class="prettyprint">
      <xmp>
        1.
        min:0,  //取0为最小刻度
        max: 100, //取100为最大刻度

        2.
        min:'dataMin', //取最小值为最小刻度
        max: 'dataMax', //取最大值为最大刻度

        3.
        min: function(value) {//取最小值向下取整为最小刻度
            return Math.floor(value.min)
        },
        max: function(value) {//取最大值向上取整为最大刻度
            return  Math.ceil(value.max) 
        },

        4.
        scale: true, //自适应
        minInterval: 0.1, //分割刻度
      </xmp>
    </pre>
    <h4>參考</h4>
    <ul>
      <li>
        <a href="https://www.jianshu.com/p/34351adb4fc0">ECharts关于y轴刻度调整</a>
      </li>
      <li>
        <a href="https://echarts.apache.org/zh/option.html#dataZoom-slider">echarts 中文</a>
      </li>
    </ul>
    <h3>echarts tooltip(提示框)</h3>
    <p></p>
    <pre class="prettyprint">
      <xmp>
        tooltip: {
          //'axis'：当鼠标悬停在坐标轴上的刻度线或者坐标轴标签上时触发 tooltip 显示。这可以用于显示坐标轴相关的信息。
          trigger: 'axis',
          // 十字准星线类型
          axisPointer: { type: 'cross' }
        },
      </xmp>
    </pre>
    <h3>echarts style</h3>
    <p>全局顏色順序跟series 一樣排序</p>
    <pre class="prettyprint">
      <xmp>
        option = {
          // 全局调色盘。
          color: [
            '#dd6b66',
            '#759aa0',
            '#e69d87',
          ],
          series: [
          {
            type: 'bar',
            // 此系列自己的调色盘。
            color: [
              '#dd6b66',
              '#759aa0',
              '#e69d87',
            ]
            // ...
          },
          {
            type: 'pie',
            // 此系列自己的调色盘。
            color: [
              '#37A2DA',
              '#32C5E9',
              '#67E0E3',
            ]
            // ...
          }
        }
      </xmp>
    </pre>
    <h4>參考</h4>
    <ul>
      <li>
        <a href="https://echarts.apache.org/handbook/zh/concepts/style">echarts style</a>
      </li>
    </ul>


    <h2>Apache服務器運行Node.js服務器</h2>
    <h3>1.在Apache->httpd.conf 加入ProxyPass</h3>
    <p>/stock2/會轉成->http://localhost:3000/</p>
    <p>/stock2/多個斜線因為後面會有接值</p>
    <pre class="prettyprint">
      <xmp>
        ProxyPass /stock2/ http://localhost:3000/
      </xmp>
    </pre>
    <h3>2.刪除註釋</h3>
    <pre class="prettyprint">
      <xmp>
        LoadModule proxy_module modules/mod_proxy.so
        LoadModule proxy_http_module modules/mod_proxy_http.so
      </xmp>
    </pre>
    <h4>參考</h4>
    <ul>
      <li>
        <a href="https://medium.com/@chamiperera95/how-to-run-node-js-server-and-apache-server-together-ee225ece6a44">參考</a>
      </li>
      <li>
        <a href="https://blog.csdn.net/u011277123/article/details/77165137">參考</a>
      </li>
    </ul>
    <hr>


    <h2>爬蟲用 request + cheerio</h2>
    <h3>安裝</h3>
    <pre class="prettyprint">
      <xmp>
        npm install request cheerio
      </xmp>
    </pre>
    <h3>一般網站的防爬蟲機制</h3>
    <p>直接偵測requests的header</p>
    <pre class="prettyprint">
      <xmp>
        headers:{'user-agent': 'Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/52.0.2743.116 Safari/537.36'}
      </xmp>
    </pre>
    <h4>參考</h4>
    <ul>
      <li>
        <a href="https://andy6804tw.github.io/2018/02/11/nodejs-crawler/">[Node.js 爬蟲] 用 request + cheerio 抓取地震資訊</a>
      </li>
      <li>
        <a href="https://ithelp.ithome.com.tw/articles/10191165">html檔的取得及常見問題</a>
      </li>
    </ul>
    <hr>


    <h2>npm yahoo-finance 抓取股票</h2>
    <h3>1.安裝</h3>
    <pre class="prettyprint">
      <xmp>
        npm install --save yahoo-finance
      </xmp>
    </pre>
    <h4>參考</h4>
    <ul>
      <li>
        <a href="https://www.npmjs.com/package/yahoo-finance">yahoo-finance</a>
      </li>
    </ul>
    <hr>


    <h2>npm Express</h2>
    <p>Express前後端網頁框架</p>
    <h3>1.安裝</h3>
    <pre class="prettyprint">
      <xmp>
        npm install express --save
      </xmp>
    </pre>
    <h3>2.路由</h3>
    <h3>3.middleware</h3>
    <h3>4.載入靜態檔案 static</h3>
    <pre class="prettyprint">
      <xmp>
        <!-- express 的靜態方法去找到要呈現的靜態檔案。需加上這一段 -->
        app.use(express.static('public'));
        app.get("/", (req, res) => {
          res.send("
          <h1>這是 middleware 練習</h1>
          "+ "
          <img src="./images/book.jpg">
          ");
        });
      </xmp>
    </pre>
    <h4>參考</h4>
    <ul>
      <li>
        <a href="https://ithelp.ithome.com.tw/articles/10237562">參考</a>
      </li>
      <li>
        <a href="https://ithelp.ithome.com.tw/articles/10308430">Node.js - Express.js 介紹與起手式</a>
      </li>
    </ul>
    <hr>

    <h2>npm nodemon 自動刷新 </h2>
    <p>安裝 npm i nodemon -D</p>
    <h3>更改 package.json 的配置</h3>
    <pre class="prettyprint">
      <xmp>
        "scripts": {
          "start": "npm run build && node ./dist/index.js",
          "start:dev": "nodemon --exec ts-node ./src/index.ts",
          "build": "tsc"
        }
      </xmp>
    </pre>
    <h4>參考</h4>
    <ul>
      <li>
        <a href="https://ithelp.ithome.com.tw/articles/10239787">nodemon 自動刷新 </a>
      </li>
    </ul>
    <hr>


    <h2>npm EJS</h2>
    <p>是一個簡易的模板語法</p>
    <h3>安裝</h3>
    <pre class="prettyprint">
      <xmp>
        npm i -D ejs
        npm i -D ejs-locals
      </xmp>
    </pre>
    <h3>引入EJS</h3>
    <pre class="prettyprint">
      <xmp>
        <!-- EJS 核心 -->
        const engine = require("ejs-locals");
      app.engine("ejs", engine);
        <!-- 讀取 EJS 檔案位置 -->
        app.set('views','./views');
        <!-- 用 EJS 引擎跑模板 -->
        app.set("view engine", "ejs");
        <!-- 引入 index.ejs -->
        app.get("/", (req, res) => {
        res.render("index");
      });
      </xmp>
    </pre>
    <h3>將JSON對像傳遞給模板之前，您需要將其轉換回字符串</h3>
    <pre class="prettyprint">
      <xmp>
        var str = JSON.parse('[{"name":"bill", "age":"26"}, {"name":"jeff", "age":"32"}]');
        app.get('/data', function(req, res){
            res.render('data', { str: JSON.stringify(str) });
        });
      </xmp>
    </pre>
    <h3>將JSON對像轉換字符串存才能存在js，之後再轉對像使用</h3>
    <pre class="prettyprint">
      <xmp>
        JSON.parse('<%- JSON.stringify(data) %>').forEach(d=>creatStrockHtml(d))
      </xmp>
    </pre>
    <h4>參考</h4>
    <ul>
      <li>
        <a href="https://ithelp.ithome.com.tw/articles/10308702">Node.js - EJS 介紹與起手式</a>
      </li>
      <li>
        <a href="https://medium.com/web-design-zone/ejs%E6%A8%A3%E6%9D%BF%E5%BC%95%E6%93%8E%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F-40873ea2dfae" target="_blank">Node.js — EJS樣板引擎的使用方式</a>
      </li>
      <li>
        <a href="https://stackoverflow.com/questions/47066222/can-i-render-json-parse-data-to-ejs" target="_blank">將 JSON 數據渲染到 EJS 嗎？</a>
      </li>
      <li>
        <a href="https://ejs.co/" target="_blank">EJS</a>
      </li>
    </ul>
    <hr>

    <h2>npm cron 排程任務的工具 </h2>
    <h3>安裝</h3>
    <pre class="prettyprint">
      <xmp>
        npm install cron
      </xmp>
    </pre>
    <h3>官方範例</h3>
    <pre class="prettyprint">
      <xmp>
        var CronJob = require('cron').CronJob;
        var job = new CronJob('* * * * * *', function() {
            console.log('You will see this message every second');
        }, null, true, 'America/Los_Angeles');
        job.start();
      </xmp>
    </pre>
    <h3>api 架構</h3>
    <pre class="prettyprint">
      <xmp>
        constructor(cronTime, onTick, onComplete, start, timezone, context, runOnInit, unrefTimeout)
        cronTime [必填] 設定定時任務時間
        onTick [必填] 定時任務要執行的函式
        onComplete [選填] 完成定時任務後要執行的函式
        Start [選填] 是否自動啟動job，默認為false
        timeZone [選填] - 指定執行的時區
      </xmp>
    </pre>
    <h3>cronTime 語法</h3>
    <pre class="prettyprint">
      <xmp>
        //每秒都執行
        * * * * * *

        //每分鐘的第 10 秒執行
        10 * * * * *

        //每天晚上 10點30分10秒時執行
        10 30 22 * * *
      </xmp>
    </pre>
    <h3>調整 package.json，建立專門跑排程的 scripts</h3>
    <pre class="prettyprint">
      <xmp>
        start : mac 執行單次爬蟲時使用的
        win_start : windows 執行單次爬蟲時使用的(需要將單引號與雙引號反過來，因為 windows 只會將單引號內的資訊印除來而不會去執行)
        cron : mac、windows 排程執行爬蟲時使用的
        
        "scripts": {
          "start": "node  -e 'require(\"./index\").crawler()'",
          "win_start": "node  -e \"require('./index').crawler()\"",
          "cron":"node tools/cron.js"
        }
      </xmp>
    </pre>
    <h4>參考</h4>
    <ul>
      <li>
        <a href="https://ithelp.ithome.com.tw/articles/10295841"> 設定排程任務的工具 - node-cron</a>
      </li>
      <li>
        <a href="https://ithelp.ithome.com.tw/articles/10249462">排程 - Cron套件超詳解，讓爬蟲自己動起來</a>
      </li>
      <li>
        <a href="https://www.zeitverschiebung.net/en/">時區代碼參考網站</a>
      </li>
    </ul>
    <hr>


    <h2>npm mysql</h2>
    <h3>sql datetime to node.js</h3>
    <p>sql時間轉換</p>
    <pre class="prettyprint">
      <xmp>
        var datee = new Date('dateTime');
      console.log(
        datee.getFullYear()+'-'+
        ('0'+(datee.getMonth()+1)).slice(-2)+'-'+
        ('0'+datee.getDate()).slice(-2)+' '+
        ('0'+(datee.getHours())).slice(-2)+':'+
        ('0'+(datee.getMinutes())).slice(-2)+':'+
        ('0'+(datee.getSeconds())).slice(-2)
      );
      </xmp>
    </pre>
    <h4>參考</h4>
    <ul>
      <li>
        <a href="https://stackoverflow.com/questions/62120309/sql-datetime-to-nodejs">SQL DATETIME to Nodejs</a>
      </li>
    </ul>
    <hr>


    <h2>Node.js-Express+MySQL</h2>
    <p>安裝npm i mysql</p>
    <h3></h3>
    <pre>
      <xmp>
        var users = require('./routes/users');
        // DataBase 
        var mysql = require("mysql");
        var con = mysql.createConnection({
            host: "localhost",
            user: "root",
            password: "",
            database: "test"
        });
        con.connect(function(err) {
            if (err) {
                console.log('connecting error');
                return;
            }
            console.log('connecting success');
        });
      </xmp>
    </pre>
    <h4>參考</h4>
    <ul>
      <li>
        <a href="https://dotblogs.com.tw/explooosion/2016/07/18/010601">參考</a>
      </li>
      <li>
        <a href="https://www.youtube.com/watch?v=f5kye3ESXE8&ab_channel=Raddy">參考</a>
      </li>
    </ul>
    <hr>



    <h2>未實現</h2>
    <p>股票回測</p>
    <p>KD圖表</p>
    <p>八大官股</p>
    <p>領先指標</p>
    <p>小台閃戶多空比</p>
    <p>首頁/回測</p>
    <p>首頁/切換大戶買賣</p>
  </body>
</html>
