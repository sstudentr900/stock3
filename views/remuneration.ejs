<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('publicHead') -%>
  <style>
    /*remuneration--------------------------------------------------------------------*/
    .remuneration .publicContent{
      padding-bottom: 0;
    }
    .remuneration .customTable{
      border: 1px solid #4A4C55;
      display: flex;
      height: calc(100vh - 77px - 50px - 100px - 48px);
      overflow: auto;
    }
    .remuneration .customTable ul{
      flex: 0 0 120px;
    }
    .remuneration .customTable ul.table_title{
      position: sticky;
      left: 0;
      z-index: 1;
    }
    .remuneration .customTable ul.table_title li{
      background-color: #252730;
      border-right: 1px solid #4A4C55;
    }
    .remuneration .customTable ul.table_content+.table_content li{
      border-left: 1px solid #4A4C55;
    }
    .remuneration .customTable ul li:first-child{
      border-bottom: 1px solid #4A4C55;
      background-color: #252730;
      position: sticky;
      top: 0;
    }
    .remuneration .customTable li{
      padding: 12px;
      height: 50px;
    }
    .remuneration .customTable li+li{
      border-top: 1px solid #4A4C55;
    }
    .remuneration .customTable li.name{
      height: 75px;
    }
    .remuneration .publictitle{
      display: flex;
      align-items: flex-end;
      justify-content: space-between;
    }
    .remuneration .publictitle .title{
      display: flex;
      align-items: center;
    }
    .remuneration .publictitle .time{
      font-size: 13px;
      color: #7d7b8a;
    }
    .remuneration .control a.add{
      margin-left: 5px;
      width: 24px;
      display: flex;
      align-items: center;
    }
    .remuneration .control a.add svg{
      margin-top: 1px;
      fill: #3A61F6;
    }
    .remuneration .control a.delet{
      width: 18px;
      position: absolute;
      right: 5px;
      bottom: 10px;
    }
    .remuneration .control a.delet svg{
      fill: #F95F53;
    } 
  </style>
  <script>
    async function getJSON({url,method,headers,body}){
      const response = await fetch(
        url,
        {
          method: method,
          headers: headers,
          body: JSON.stringify(body)
        }
      );
      return await response.json();
    }
    // function getJSON2(url,obj){
    //   fetch(url,obj)
    //   .then((response)=>response.json())
    //   .then(function (myJson) {
    //     console.log(myJson);
    //   });
    // }

    function addStrock(){
      const stockNo = window.prompt('您好!請輸入股號', '0050');
      if (stockNo) {
        const stockName = window.prompt('請輸入股名', '元大高息');
        if (stockName) {
          console.log('ok',stockNo,stockName)
          getJSON({
            'url': './remuneration',
            'method': 'post',
            'headers':{
              "Content-Type": "application/json",
              "Accept": "application/json",
            },
            'body':{
              "stockNo": stockNo,
              "stockName": stockName
            }
          }).then(function (myJson) {
            console.log(myJson);
          });
        } 
      } 
    }
    function deletStrock(obj){
      if (confirm('你確定你要刪除該股票') == true) {
        obj.closest('.table_content').remove();
      }
    }
  </script>
</head>
<body>
  <div class="publicPage <%= active %>">
    <%- include('publicNav') -%>
    <div class="publicContent">
      <div class="publicWidth">
        <div class="publicBox">
          <div class="publictitle">
            <div class="title">
              <h4>股票報酬統計</h4>
              <div class="control">
                <a href="javascript:;" class="add" onClick="addStrock()">
                  <svg clip-rule="evenodd" fill-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m12.002 2c5.518 0 9.998 4.48 9.998 9.998 0 5.517-4.48 9.997-9.998 9.997-5.517 0-9.997-4.48-9.997-9.997 0-5.518 4.48-9.998 9.997-9.998zm0 1.5c-4.69 0-8.497 3.808-8.497 8.498s3.807 8.497 8.497 8.497 8.498-3.807 8.498-8.497-3.808-8.498-8.498-8.498zm-.747 7.75h-3.5c-.414 0-.75.336-.75.75s.336.75.75.75h3.5v3.5c0 .414.336.75.75.75s.75-.336.75-.75v-3.5h3.5c.414 0 .75-.336.75-.75s-.336-.75-.75-.75h-3.5v-3.5c0-.414-.336-.75-.75-.75s-.75.336-.75.75z" fill-rule="nonzero"/></svg>
                </a>
              </div>
            </div>
            <p class="time">更新時間 : <%= data[0]['dataDate'] %></p>
          </div>
          <div class="customTable">
            <ul class="table_title">
              <li class="name"><p>名稱</p></li>
              <% data[0]['stockPayYear'].forEach(function(y) { %>
                <li class="<%= y.year %>"><p><%= y.year %>年</p></li>
              <% }); %>
              <li>年化</li>
              <% data[0]['stockPayMonth'].forEach(function(m) { %>
                <li class="<%= m.month %>"><p><%= m.month %>月</p></li>
              <% }); %>
            </ul>
            <% data.forEach(function(d) { %>
              <ul class="table_content">
                <li class="name">
                  <div class="text">
                    <p class="publicEllipsis1"><%= d.stockname %></p>
                    <p><%= d.stockno %></p>
                  </div>
                  <div class="control">
                    <a href="javascript:;" class="delet" onClick="deletStrock(this)" data-id="<%= d.id %>">
                      <svg clip-rule="evenodd" fill-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m12.002 2.005c5.518 0 9.998 4.48 9.998 9.997 0 5.518-4.48 9.998-9.998 9.998-5.517 0-9.997-4.48-9.997-9.998 0-5.517 4.48-9.997 9.997-9.997zm0 1.5c-4.69 0-8.497 3.807-8.497 8.497s3.807 8.498 8.497 8.498 8.498-3.808 8.498-8.498-3.808-8.497-8.498-8.497zm4.253 7.75h-8.5c-.414 0-.75.336-.75.75s.336.75.75.75h8.5c.414 0 .75-.336.75-.75s-.336-.75-.75-.75z" fill-rule="nonzero"/></svg>
                    </a>
                  </div>
                </li>
                <% d.stockPayYear.forEach(function(y) { %>
                  <li class="<%= y.year %>"><p><%= y.avenge %></p></li>
                <% }); %>
                <li><p><%= d.stockCagr %></p></li>
                <% d.stockPayMonth.forEach(function(m) { %>
                  <li class="<%= m.month %>"><p><%= m.avenge %></p></li>
                <% }); %>
              </ul>
            <% }); %>
          </div>
        </div>
      </div>
    </div>
    <%- include('publicFooter') -%>
  </div>
</body>
</html>